<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="002" author="cashflow-service">
        <comment>Add performance indexes for Cash Flow Management Service</comment>
        
        <!-- Indexes for cash_flows table -->
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_contract_id">
            <column name="contract_id"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_cash_flow_date">
            <column name="cash_flow_date"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_status">
            <column name="status"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_request_id">
            <column name="request_id"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_calculation_id">
            <column name="calculation_id"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_lot_id">
            <column name="lot_id"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_contract_date_type">
            <column name="contract_id"/>
            <column name="cash_flow_date"/>
            <column name="cash_flow_type"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_settlement_date">
            <column name="settlement_date"/>
        </createIndex>
        
        <createIndex tableName="cash_flows" indexName="idx_cash_flows_currency">
            <column name="currency"/>
        </createIndex>

        <!-- Indexes for settlement_instructions table -->
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_contract_id">
            <column name="contract_id"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_cash_flow_id">
            <column name="cash_flow_id"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_settlement_date">
            <column name="settlement_date"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_status">
            <column name="status"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_priority">
            <column name="priority"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_request_id">
            <column name="request_id"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_natural_key">
            <column name="contract_id"/>
            <column name="cash_flow_id"/>
            <column name="settlement_date"/>
            <column name="settlement_type"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_settlement_type">
            <column name="settlement_type"/>
        </createIndex>
        
        <createIndex tableName="settlement_instructions" indexName="idx_settlement_instructions_currency">
            <column name="currency"/>
        </createIndex>

        <!-- Indexes for calculation_requests table -->
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_contract_id">
            <column name="contract_id"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_from_date">
            <column name="from_date"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_to_date">
            <column name="to_date"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_status">
            <column name="status"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_calculation_type">
            <column name="calculation_type"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_calculation_id">
            <column name="calculation_id"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_input_data_hash">
            <column name="input_data_hash"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_natural_key">
            <column name="contract_id"/>
            <column name="from_date"/>
            <column name="to_date"/>
            <column name="calculation_type"/>
        </createIndex>
        
        <createIndex tableName="calculation_requests" indexName="idx_calculation_requests_created_at">
            <column name="created_at"/>
        </createIndex>

    </changeSet>

</databaseChangeLog>
